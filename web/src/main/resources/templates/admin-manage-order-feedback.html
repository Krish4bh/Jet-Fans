<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jet Fans</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" th:href="@{/css/fragments.css}" />
    <link rel="stylesheet" th:href="@{/css/user-profile.css}" />
    <style>
      /* small layout tweaks to match left-right split used in user-profile */
      .manage-section {
        padding-top: 30px;
        padding-bottom: 50px;
      }
      .orders-column {
        border-right: 1px solid #e9ecef;
      }
      .order-card {
        background: #fff;
      }
      .feedback-card {
        background: #fff;
        margin-bottom: 16px;
      }
      .action-btn {
        min-width: 120px;
      }
      .feedback-meta {
        font-size: 0.9rem;
        color: #6c757d;
      }
      .section-title {
        font-size: 1.25rem;
        margin-bottom: 1rem;
      }
      body {
        padding-top: 0;
      }
    </style>
  </head>

  <body>
    <nav class="navbar bg-light">
      <div
        class="container-fluid d-flex justify-content-between align-items-center"
      >
        <!-- Brand -->
        <a th:href="@{/jet-fans/home}" class="text-decoration-none">
          <p
            class="navbar-brand my-0 ms-5 me-0 p-0"
            style="font-family: 'Dancing Script', cursive; font-size: 40px"
          >
            Jet Fans
          </p>
        </a>

        <a th:href="@{/admin/admin-home}" class="text-decoration-none"
          ><span class="my-0 fs-4 fw-medium text-dark"> Admin Dashboard </span
          ><small class="text-body-primary" style="font-size: 12px">
            way to Admin home</small
          ></a
        >

        <!-- Right section: admin name + logout -->
        <div class="d-flex align-items-center me-5">
          <div th:if="${session.loggedInAdmin != null}" class="me-3">
            <span class="text-dark fs-5">
              Hi,
              <span
                th:text="${session.loggedInAdmin.name}"
                style="
                  font-family: 'Dancing Script', cursive;
                  color: red;
                  font-size: x-large;
                "
              ></span>
            </span>
          </div>

          <form th:action="@{/admin/logout}" method="get" class="m-0">
            <button class="btn btn-secondary" id="logout-btn">Log out</button>
          </form>
        </div>
      </div>
    </nav>

    <hr class="m-0" />

    <section class="manage-section container">
      <div class="row g-4">
        <!-- Left column: Orders -->
        <div class="col-lg-7 col-md-7 orders-column">
          <h3 class="section-title">
            <i class="bi bi-bag me-2"></i>Orders Placed
          </h3>

          <div
            th:if="${successMessage}"
            class="alert alert-success"
            th:text="${successMessage}"
          ></div>
          <div
            th:if="${errorMessage}"
            class="alert alert-danger"
            th:text="${errorMessage}"
          ></div>

          <div
            th:if="${#lists.isEmpty(orders)}"
            class="text-center text-muted mt-5"
          >
            <p>No orders found.</p>
          </div>

          <div th:each="order : ${orders}" class="mb-4">
            <div class="order-card p-3 border rounded shadow-sm mb-3">
              <div
                class="order-top d-flex justify-content-between align-items-center mb-2"
              >
                <div>
                  <span class="fw-semibold"
                    >Order #<span th:text="${order.id}"></span
                  ></span>
                  <div class="text-muted small">
                    <i class="bi bi-person me-1"></i>
                    <span
                      th:text="${order.user != null ? order.user.name : '—'}"
                    ></span>
                    &nbsp; • &nbsp;
                    <i class="bi bi-calendar me-1"></i>
                    <span
                      th:text="${#temporals.format(order.createdAt, 'dd MMM yyyy')}"
                    ></span>
                  </div>
                </div>

                <div class="text-end">
                  <div class="fw-semibold">
                    ₹ <span th:text="${order.totalAmount}"></span>
                  </div>
                  <div class="text-muted small">
                    Payment: <strong>Cash on Delivery</strong>
                  </div>
                </div>
              </div>

              <div
                th:each="product : ${order.products}"
                class="d-flex align-items-center border p-2 rounded mb-2"
              >
                <img
                  th:src="@{/Product-Imgs/{img}(img=${product.image})}"
                  alt="Product Image"
                  class="me-3 rounded"
                  style="width: 60px; height: 60px; object-fit: cover"
                />
                <div class="flex-grow-1">
                  <h6 th:text="${product.title}" class="mb-1"></h6>
                  <small class="text-muted"
                    >₹<span th:text="${product.price}"></span
                  ></small>
                </div>
              </div>

              <div
                class="d-flex justify-content-between align-items-center mt-2"
              >
                <div>
                  <span class="badge bg-light text-dark">PLACED</span>
                </div>
                <div>
                  <form
                    th:action="@{|/admin/orders/${order.id}/cancel|}"
                    method="post"
                    style="display: inline"
                  >
                    <button
                      type="submit"
                      class="btn btn-outline-danger btn-sm action-btn"
                      onclick="return confirm('Cancel order #' + [[${order.id}]] + '?');"
                    >
                      <i class="bi bi-x-circle me-1"></i>Cancel Order
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right column: Feedbacks -->
        <div class="col-lg-5 col-md-5">
          <h3 class="section-title">
            <i class="bi bi-chat-left-text me-2"></i>Feedbacks
          </h3>

          <div
            th:if="${#lists.isEmpty(feedbacks)}"
            class="text-center text-muted mt-4"
          >
            <p>No feedbacks submitted.</p>
          </div>

          <div
            th:each="fb : ${feedbacks}"
            class="feedback-card p-3 border rounded shadow-sm mb-3"
          >
            <div class="d-flex justify-content-between align-items-start">
              <div class="flex-grow-1">
                <h6 class="mb-1" th:text="${fb.title}"></h6>
                <p class="mb-1" th:text="${fb.comment}"></p>
                <div class="feedback-meta">
                  <span>Anonymous</span>
                  &nbsp;•&nbsp;
                  <span
                    th:text="${fb.product != null ? fb.product.title : '—'}"
                  ></span>
                  &nbsp;•&nbsp;
                  <span
                    th:text="${#temporals.format(fb.createdAt, 'dd MMM yyyy')}"
                  ></span>
                </div>
              </div>

              <div class="ps-2">
                <form
                  th:action="@{|/admin/feedbacks/${fb.id}/delete|}"
                  method="post"
                >
                  <button
                    class="btn btn-outline-secondary btn-sm"
                    onclick="return confirm('Delete this feedback?');"
                  >
                    <i class="bi bi-trash"></i>
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <div th:replace="~{fragments :: footer}"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/js/admin-home.js}"></script>
  </body>
</html>
